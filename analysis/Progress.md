# Анализ покрытия ext4

## Первый запуск

Входные данные:
- Конфигурация - minimal.
- Набор тестов - ext4/*

Результат:
- По строкам - `62.5%`
- По функциям - `75.1%`

## Второй запуск

Входные данные:
- Конфигурация - minimal.
- Набор тестов - все.

Результат:
- По строкам - `67.4%`
- По функциям - `79.1%`

Анализ запущенных тестов:
- В директории `improvements/iteration 1` можно найти описания улучшений, нацеленных на запуск большего количества тестов.

## Третий запуск

К сожалению, улучшения из предыдущего пункта помогли не сильно.

Они закрыли какие-то дыры, например полностью не тестировался `verity.c`,
а сейчас его покрытие - 80% (однако строк в нём мало - всего 178).

Однако это не помогло улучшить картину в целом - некоторые большие файлы
(например `inline.c` и `fast_commit.c`) имеют практически нулевое покрытие.

Нужно детально анализировать, почему они так сильно игнорируются и найти способ покрыть этот код.

Входные данные:
- Конфигурация - minimal.
- Набор тестов - все.

Результат:
- По строкам - `68.2%`
- По функциям - `80.1%`

## Четвёртый запуск

Починил все проблемы кроме двух (запуск на SELinux и наличие e2fuzz) и дописал конфигурацию тестов, теперь в ней 6 секций, вместо одной.

Запускал все тесты на всех секциях (то есть весь набор из ~800 тестов отработал 6 раз).

Это очень долго, в будущем на специфичных секциях нужно будет запускать специфичные тесты
(например, для секции dax только тесты требующие устройства с персистентной памятью).

Покрытие выросло, но незначительно.
Кажется, что запуск большего числа тестов себя исчерпал и стоит двигаться дальше.

Нужно проанализировать различные фичи ext4 и то, как они влияют на покрытие.
После этого добавить в конфигурацию секции с включением/выключением нужных фич (это делается через опции mkfs).

Входные данные:
- Конфигурация - full.
- Набор тестов - все

Результат:
- По строкам - `70.8%`
- По функциям - `82.3%`

## Пятый запуск

Оптимизировал запуск тестов.
Теперь для специфичных секций (dax, logwrites, etc.) запускаются только тесты, требующие этой конфигурации.
Есть также одна секция в которой запускаются все тесты и при этом включено большое количество опций MKFS.

Входные данные:
- Конфигурация - optimized_full.
- Набор тестов - все для секции с опциями MKFS, конкретные тесты для остальных секций.

Теперь тесты работают быстрее и покрытия собирается сильно больше:
- По строкам - `77.2%`
- По функциям - `88.7%`
